{% extends "base.html" %}

{% block title %}제품 관리 - Orio ERP v2{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">
        <i class="fa-solid fa-box"></i> 제품 관리
    </h1>
    <p class="page-subtitle">상품 및 박스 정보 관리</p>
</div>

<!-- 검색 필터 -->
<div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
        <div class="card-title" style="margin:0;"><i class="fa-solid fa-filter"></i> 검색 필터</div>
        <div style="display:flex;gap:12px;margin:0;">
            <button class="btn btn-secondary btn-sm" onclick="resetFilters()">
                <i class="fa-solid fa-rotate-right"></i> 초기화
            </button>
            <button class="btn btn-primary btn-sm" onclick="applyFilters()">
                <i class="fa-solid fa-search"></i> 검색
            </button>
        </div>
    </div>
    <div class="search-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;">
        <div>
            <label class="form-label">브랜드</label>
            <select id="filterBrand" class="form-select">
                <option value="">전체</option>
            </select>
        </div>
        <div>
            <label class="form-label">고유코드</label>
            <input type="text" id="filterUniqueCode" class="form-input" list="uniqueCodeList" placeholder="고유코드 검색...">
            <datalist id="uniqueCodeList"></datalist>
        </div>
        <div>
            <label class="form-label">상품명</label>
            <input type="text" id="filterName" class="form-input" list="nameList" placeholder="상품명 검색...">
            <datalist id="nameList"></datalist>
        </div>
        <div>
            <label class="form-label">유형</label>
            <select id="filterBundleType" class="form-select">
                <option value="">전체</option>
            </select>
        </div>
    </div>
</div>

<!-- Master-Detail Layout -->
<div style="display:grid;grid-template-columns:1.7fr 1fr;gap:24px;">
    <!-- Master: Products -->
    <div class="card">
        <div style="margin-bottom:16px;">
            <div
                style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;flex-wrap:wrap;gap:8px;">
                <div style="display:flex;align-items:center;gap:8px;">
                    <h2 class="card-title" style="margin:0;white-space:nowrap;">제품 목록</h2>
                    <select id="limitSelector" onchange="changeLimit()" class="form-select"
                        style="padding:8px;font-size:13px;width:auto;">
                        <option value="20" selected>20개씩</option>
                        <option value="50">50개씩</option>
                        <option value="100">100개씩</option>
                    </select>
                </div>
                <div style="display:flex;gap:8px;flex-wrap:wrap;">
                    <button class="btn btn-success btn-sm" onclick="showIntegratedAddModal()">
                        <i class="fa-solid fa-plus"></i> 통합 추가
                    </button>
                    <button class="btn btn-primary btn-sm" onclick="downloadExcel()">
                        <i class="fa-solid fa-download"></i> 엑셀 다운로드
                    </button>
                    <button class="btn btn-secondary btn-sm" onclick="selectAllData()">
                        <i class="fa-solid fa-check-double"></i> 전체 선택
                    </button>
                    <button class="btn btn-primary btn-sm btn-disabled" onclick="bulkEdit()" id="editButton">
                        <i class="fa-solid fa-edit"></i> 선택 수정
                    </button>
                    <button class="btn btn-danger btn-sm btn-disabled" onclick="bulkDelete()" id="deleteButton">
                        <i class="fa-solid fa-trash"></i> 선택 삭제
                    </button>
                </div>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;">
                <span style="color:var(--text-muted);font-size:13px;" id="totalCount">총 0개</span>
                <span style="color:var(--text-muted);font-size:13px;" id="filteredCount"></span>
            </div>
        </div>

        <div class="table-container">
            <table class="table" id="master-table">
                <thead>
                    <tr></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <div id="pagination" style="display:flex;justify-content:center;gap:8px;margin-top:20px;"></div>
    </div>

    <!-- Detail: Product Boxes -->
    <div class="card">
        <div style="margin-bottom:16px;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                <h2 class="card-title" style="margin:0;">제품 박스</h2>
                <div style="display:flex;gap:8px;" id="boxActionButtons" style="display:none;">
                    <button class="btn btn-success btn-sm" onclick="showAddBoxModal()">
                        <i class="fa-solid fa-plus"></i> 박스 추가
                    </button>
                    <button class="btn btn-primary btn-sm btn-disabled" onclick="bulkEditBoxes()" id="editBoxButton">
                        <i class="fa-solid fa-edit"></i> 선택 수정
                    </button>
                    <button class="btn btn-danger btn-sm btn-disabled" onclick="bulkDeleteBoxes()" id="deleteBoxButton">
                        <i class="fa-solid fa-trash"></i> 선택 삭제
                    </button>
                </div>
            </div>
            <span style="color:var(--text-muted);font-size:13px;display:none;" id="boxCount">박스 0개</span>
        </div>

        <div id="detailPlaceholder" style="text-align:center;padding:60px 20px;color:var(--text-muted);">
            <i class="fa-solid fa-hand-pointer"
                style="font-size:48px;margin-bottom:16px;opacity:0.3;display:block;"></i>
            <p>제품을 선택하세요</p>
        </div>

        <div class="table-container" id="boxTableContainer" style="display:none;">
            <table class="table" id="detail-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ERP코드</th>
                        <th>입수량</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<!-- Integrated Add Modal -->
<div id="integratedAddModal" class="modal">
    <div class="modal-content" style="max-width:800px;">
        <div class="modal-header">
            <h2 class="modal-title">제품 통합 추가</h2>
            <button class="modal-close" onclick="closeIntegratedAddModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;">
                <!-- Product Info -->
                <div>
                    <h4
                        style="margin-bottom:16px;color:var(--accent);border-bottom:2px solid var(--accent);padding-bottom:8px;">
                        제품 정보</h4>
                    <div class="form-group">
                        <label class="form-label">브랜드</label>
                        <select id="intBrand" class="form-select"></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">고유코드</label>
                        <input type="text" id="intUniqueCode" class="form-input" placeholder="예: 10001">
                    </div>
                    <div class="form-group">
                        <label class="form-label required">제품명</label>
                        <input type="text" id="intName" class="form-input" placeholder="제품명 입력">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required">TypeERP</label>
                            <select id="intTypeERP" class="form-select"></select>
                        </div>
                        <div class="form-group">
                            <label class="form-label required">TypeDB</label>
                            <select id="intTypeDB" class="form-select"></select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">기본바코드</label>
                            <input type="text" id="intBaseBarcode" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">바코드2</label>
                            <input type="text" id="intBarcode2" class="form-input">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">사방넷코드</label>
                            <input type="text" id="intSabangnetCode" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">사방넷고유코드</label>
                            <input type="text" id="intSabangnetUniqueCode" class="form-input">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">번들타입</label>
                            <select id="intBundleType" class="form-select"></select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">상태</label>
                            <select id="intStatus" class="form-select"></select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">중분류</label>
                            <input type="text" id="intCategoryMid" class="form-input" list="categoryMidList">
                        </div>
                        <div class="form-group">
                            <label class="form-label">소분류</label>
                            <input type="text" id="intCategorySub" class="form-input" list="categorySubList">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">출시일</label>
                        <input type="date" id="intReleaseDate" class="form-input">
                    </div>
                </div>

                <!-- Box Info -->
                <div>
                    <h4
                        style="margin-bottom:16px;color:var(--accent);border-bottom:2px solid var(--accent);padding-bottom:8px;">
                        박스 정보</h4>
                    <div class="form-group">
                        <label class="form-label required">ERP코드 (품목코드)</label>
                        <input type="text" id="intERPCode" class="form-input" placeholder="예: A001">
                    </div>
                    <div class="form-group">
                        <label class="form-label required">입수량</label>
                        <input type="number" id="intQuantityInBox" class="form-input" value="1" min="1">
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeIntegratedAddModal()">취소</button>
            <button class="btn btn-primary" onclick="saveIntegrated()">저장</button>
        </div>
    </div>
</div>

<!-- Add Box Modal -->
<div id="addBoxModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">박스 추가</h2>
            <button class="modal-close" onclick="closeAddBoxModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label required">ERP코드 (품목코드)</label>
                <input type="text" id="boxERPCode" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label required">입수량</label>
                <input type="number" id="boxQuantityInBox" class="form-input" value="1" min="1">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeAddBoxModal()">취소</button>
            <button class="btn btn-primary" onclick="saveBox()">저장</button>
        </div>
    </div>
</div>

<!-- Bulk Edit Product Modal -->
<div id="bulkEditProductModal" class="modal">
    <div class="modal-content" style="max-width:800px;">
        <div class="modal-header">
            <h2 class="modal-title">제품 선택 수정</h2>
            <button class="modal-close" onclick="closeBulkEditProductModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div style="background:var(--bg-hover);padding:12px;border-radius:6px;margin-bottom:16px;">
                <p style="margin:0;color:var(--text-muted);font-size:13px;">
                    <i class="fa-solid fa-info-circle"></i> 선택한 <span id="bulkEditProductCount"
                        style="color:var(--accent);font-weight:600;">0</span>개 제품을 수정합니다.
                    <br>값을 입력한 항목만 수정됩니다. (빈 칸은 유지)
                </p>
            </div>

            <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
                <div class="form-group">
                    <label class="form-label">브랜드</label>
                    <select id="bulkBrand" class="form-select"></select>
                    <small>현재: <span id="currentBrand"></span></small>
                </div>
                <div class="form-group">
                    <label class="form-label">고유코드</label>
                    <input type="text" id="bulkUniqueCode" class="form-input">
                    <small>현재: <span id="currentUniqueCode"></span></small>
                </div>
                <div class="form-group">
                    <label class="form-label">제품명</label>
                    <input type="text" id="bulkProductName" class="form-input">
                    <small>현재: <span id="currentProductName"></span></small>
                </div>
                <div class="form-group">
                    <label class="form-label">TypeERP</label>
                    <select id="bulkTypeERP" class="form-select"></select>
                    <small>현재: <span id="currentTypeERP"></span></small>
                </div>
                <div class="form-group">
                    <label class="form-label">TypeDB</label>
                    <select id="bulkTypeDB" class="form-select"></select>
                    <small>현재: <span id="currentTypeDB"></span></small>
                </div>
                <div class="form-group">
                    <label class="form-label">기본바코드</label>
                    <input type="text" id="bulkBaseBarcode" class="form-input">
                    <small>현재: <span id="currentBaseBarcode"></span></small>
                </div>
                <div class="form-group">
                    <label class="form-label">바코드2</label>
                    <input type="text" id="bulkBarcode2" class="form-input">
                    <small>현재: <span id="currentBarcode2"></span></small>
                </div>
                <div class="form-group">
                    <label class="form-label">사방넷코드</label>
                    <input type="text" id="bulkSabangnetCode" class="form-input">
                    <small>현재: <span id="currentSabangnetCode"></span></small>
                </div>
                <div class="form-group">
                    <label class="form-label">사방넷고유코드</label>
                    <input type="text" id="bulkSabangnetUniqueCode" class="form-input">
                    <small>현재: <span id="currentSabangnetUniqueCode"></span></small>
                </div>
                <div class="form-group">
                    <label class="form-label">번들타입</label>
                    <select id="bulkBundleType" class="form-select"></select>
                    <small>현재: <span id="currentBundleType"></span></small>
                </div>
                <div class="form-group">
                    <label class="form-label">중분류</label>
                    <input type="text" id="bulkCategoryMid" class="form-input" list="categoryMidList">
                    <small>현재: <span id="currentCategoryMid"></span></small>
                </div>
                <div class="form-group">
                    <label class="form-label">소분류</label>
                    <input type="text" id="bulkCategorySub" class="form-input" list="categorySubList">
                    <small>현재: <span id="currentCategorySub"></span></small>
                </div>
                <div class="form-group">
                    <label class="form-label">상태</label>
                    <select id="bulkStatus" class="form-select"></select>
                    <small>현재: <span id="currentStatus"></span></small>
                </div>
                <div class="form-group">
                    <label class="form-label">출시일</label>
                    <input type="date" id="bulkReleaseDate" class="form-input">
                    <small>현재: <span id="currentReleaseDate"></span></small>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeBulkEditProductModal()">취소</button>
            <button class="btn btn-primary" onclick="saveBulkEditProduct()">저장</button>
        </div>
    </div>
</div>

<!-- Bulk Edit Box Modal -->
<div id="bulkEditBoxModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">박스 선택 수정</h2>
            <button class="modal-close" onclick="closeBulkEditBoxModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div style="background:var(--bg-hover);padding:12px;border-radius:6px;margin-bottom:16px;">
                <p style="margin:0;color:var(--text-muted);font-size:13px;">
                    <i class="fa-solid fa-info-circle"></i> 선택한 <span id="bulkEditBoxCount"
                        style="color:var(--accent);font-weight:600;">0</span>개 박스를 수정합니다.
                </p>
            </div>
            <div class="form-group">
                <label class="form-label">ERP코드</label>
                <input type="text" id="bulkERPCode" class="form-input">
                <small>현재: <span id="currentERPCode"></span></small>
            </div>
            <div class="form-group">
                <label class="form-label">입수량</label>
                <input type="number" id="bulkQuantityInBox" class="form-input">
                <small>현재: <span id="currentQuantityInBox"></span></small>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeBulkEditBoxModal()">취소</button>
            <button class="btn btn-primary" onclick="saveBulkEditBox()">저장</button>
        </div>
    </div>
</div>

<!-- Datalists for Autocomplete -->
<datalist id="categoryMidList"></datalist>
<datalist id="categorySubList"></datalist>
<datalist id="erpCodeList"></datalist>
{% endblock %}

{% block extra_js %}
<script src="/static/js/pages/products.js"></script>
{% endblock %}