{% extends "base.html" %}
{% from "components/search-filter.html" import render_search_filter %}

{% block title %}채널 관리 - Orio ERP v2{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">
        <i class="fa-solid fa-store"></i> 채널 관리
    </h1>
    <p class="page-subtitle">채널 및 상세정보 관리</p>
</div>

<!-- 검색 필터 -->
<div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
        <div class="card-title" style="margin:0;"><i class="fa-solid fa-filter"></i> 검색 필터</div>
        <div style="display:flex;gap:12px;margin:0;">
            <button class="btn btn-secondary btn-sm" onclick="resetFilters()">
                <i class="fa-solid fa-rotate-right"></i> 초기화
            </button>
            <button class="btn btn-primary btn-sm" onclick="applyFilters()">
                <i class="fa-solid fa-search"></i> 검색
            </button>
        </div>
    </div>
    <div class="search-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;">
        <div>
            <label class="form-label">채널명</label>
            <input type="text" id="filterName" class="form-input" list="nameList" placeholder="채널명 검색...">
            <datalist id="nameList"></datalist>
        </div>
        <div>
            <label class="form-label">거래처명</label>
            <input type="text" id="filterDetailName" class="form-input" list="detailNameList" placeholder="거래처명 검색...">
        </div>
        <div>
            <label class="form-label">그룹</label>
            <input type="text" id="filterGroup" class="form-input" list="groupList" placeholder="그룹 검색...">
            <datalist id="groupList"></datalist>
        </div>
        <div>
            <label class="form-label">유형</label>
            <select id="filterType" class="form-select">
                <option value="">전체</option>
            </select>
        </div>
        <div>
            <label class="form-label">계약유형</label>
            <select id="filterContractType" class="form-select">
                <option value="">전체</option>
            </select>
        </div>
    </div>
</div>

<!-- Master-Detail Layout -->
<div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;">
    <!-- Master: Channels -->
    <div class="card">
        <div style="margin-bottom:16px;">
            <div
                style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;flex-wrap:wrap;gap:8px;">
                <div style="display:flex;align-items:center;gap:8px;">
                    <h2 class="card-title" style="margin:0;white-space:nowrap;">채널 목록</h2>
                </div>
                <div style="display:flex;gap:8px;flex-wrap:wrap;">
                    <button class="btn btn-success btn-sm" onclick="showIntegratedAddModal()">
                        <i class="fa-solid fa-plus"></i> 통합 추가
                    </button>
                    <button class="btn btn-secondary btn-sm" onclick="selectAllData()">
                        <i class="fa-solid fa-check-double"></i> 전체 선택
                    </button>
                    <button class="btn btn-primary btn-sm btn-disabled" onclick="bulkEdit()" id="editButton" disabled>
                        <i class="fa-solid fa-edit"></i> 선택 수정
                    </button>
                    <button class="btn btn-danger btn-sm btn-disabled" onclick="bulkDelete()" id="deleteButton"
                        disabled>
                        <i class="fa-solid fa-trash"></i> 선택 삭제
                    </button>
                </div>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;">
                <span style="color:var(--text-muted);font-size:13px;" id="totalCount">총 0개</span>
                <span style="color:var(--text-muted);font-size:13px;" id="filteredCount"></span>
            </div>
        </div>

        <div class="table-container">
            <table class="table" id="channelTable">
                <thead>
                    <tr></tr>
                </thead>
                <tbody id="channelTableBody">
                </tbody>
            </table>
        </div>
        <div class="pagination" id="pagination" style="display:flex;justify-content:center;gap:8px;margin-top:20px;">
        </div>
    </div>

    <!-- Detail: Channel Details -->
    <div class="card">
        <div style="margin-bottom:16px;">
            <div
                style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;flex-wrap:wrap;gap:8px;">
                <div style="display:flex;align-items:center;gap:8px;">
                    <h2 class="card-title" style="margin:0;white-space:nowrap;">채널 상세정보</h2>
                    <select id="detailLimitSelector" onchange="changeDetailLimit()" class="form-select"
                        style="padding:8px;font-size:13px;width:auto;display:none;">
                        <option value="20" selected>20개씩</option>
                        <option value="50">50개씩</option>
                        <option value="100">100개씩</option>
                    </select>
                </div>
                <div style="display:flex;gap:8px;" id="detailActionButtons" style="display:none;">
                    <button class="btn btn-success btn-sm" onclick="showAddDetailModal()">
                        <i class="fa-solid fa-plus"></i> 상세 추가
                    </button>
                    <button class="btn btn-primary btn-sm btn-disabled" onclick="bulkEditDetails()"
                        id="editDetailButton" disabled>
                        <i class="fa-solid fa-edit"></i> 선택 수정
                    </button>
                    <button class="btn btn-danger btn-sm btn-disabled" onclick="bulkDeleteDetails()"
                        id="deleteDetailButton" disabled>
                        <i class="fa-solid fa-trash"></i> 선택 삭제
                    </button>
                </div>
            </div>
            <span style="color:var(--text-muted);font-size:13px;" id="detailCount" style="display:none;">상세 0개</span>
        </div>

        <div id="detailPlaceholder" style="text-align:center;padding:60px 20px;color:var(--text-muted);">
            <i class="fa-solid fa-hand-pointer"
                style="font-size:48px;margin-bottom:16px;opacity:0.3;display:block;"></i>
            <p>채널을 선택하세요</p>
        </div>

        <div class="table-container" id="detailTableContainer" style="display:none;">
            <table class="table" id="detailTable">
                <thead>
                    <tr>
                        <th style="width:40px;"><input type="checkbox" id="selectAllDetails"
                                onchange="toggleSelectAllDetails()"></th>
                        <th>ID</th>
                        <th>사업자번호</th>
                        <th>상세명</th>
                    </tr>
                </thead>
                <tbody id="detailTableBody">
                </tbody>
            </table>
        </div>
        <div class="pagination" id="detailPagination"
            style="display:none;justify-content:center;gap:8px;margin-top:20px;"></div>
    </div>
</div>

<!-- 통합 추가 모달 -->
<div class="modal" id="integratedAddModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">채널 + 상세정보 통합 추가</h3>
            <button class="modal-close" onclick="closeIntegratedAddModal()">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        <div class="modal-body" style="max-height:70vh;overflow-y:auto;">
            <h4 style="margin-bottom:16px;color:var(--accent);">Channel 테이블 정보</h4>
            <div class="form-group">
                <label class="form-label required">채널명</label>
                <input type="text" id="intName" class="form-input" list="nameList" required>
            </div>
            <div class="form-group">
                <label class="form-label">그룹</label>
                <input type="text" id="intGroup" class="form-input" list="groupList">
            </div>
            <div class="form-group">
                <label class="form-label">유형</label>
                <select id="intType" class="form-select">
                    <option value="">선택</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">계약유형</label>
                <select id="intContractType" class="form-select">
                    <option value="">선택</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">담당자</label>
                <input type="text" id="intOwner" class="form-input" list="ownerList">
                <datalist id="ownerList"></datalist>
            </div>
            <div class="form-group">
                <label class="form-label">실시간 데이터소스</label>
                <input type="text" id="intLiveSource" class="form-input" list="liveSourceList">
                <datalist id="liveSourceList"></datalist>
            </div>
            <div class="form-group">
                <label class="form-label">사방넷몰ID</label>
                <input type="text" id="intSabangnetMallID" class="form-input" list="sabangnetMallIDList">
                <datalist id="sabangnetMallIDList"></datalist>
            </div>

            <hr style="border:none;border-top:1px solid var(--border);margin:24px 0;">

            <h4 style="margin-bottom:16px;color:var(--accent);">ChannelDetail 테이블 정보</h4>
            <div class="form-group">
                <label class="form-label required">사업자번호</label>
                <input type="text" id="intBizNumber" class="form-input" required>
            </div>
            <div class="form-group">
                <label class="form-label required">거래처명</label>
                <input type="text" id="intDetailName" class="form-input" list="detailNameList" required>
                <datalist id="detailNameList"></datalist>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeIntegratedAddModal()">
                <i class="fa-solid fa-times"></i> 취소
            </button>
            <button class="btn btn-success" onclick="saveIntegrated()">
                <i class="fa-solid fa-save"></i> 저장
            </button>
        </div>
    </div>
</div>

<!-- 마스터 선택 수정 모달 -->
<div class="modal" id="bulkEditChannelModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">채널 선택 수정</h3>
            <button class="modal-close" onclick="closeBulkEditChannelModal()">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        <div class="modal-body" style="max-height:70vh;overflow-y:auto;">
            <div style="background:var(--bg-hover);padding:12px;border-radius:6px;margin-bottom:16px;">
                <p style="margin:0;color:var(--text-muted);font-size:13px;">
                    <i class="fa-solid fa-info-circle"></i> 선택한 <span id="bulkEditChannelCount"
                        style="color:var(--accent);font-weight:600;">0</span>개 채널을 수정합니다.
                </p>
            </div>
            <h4 style="margin-bottom:16px;color:var(--accent);">Channel 테이블 정보</h4>
            <div class="form-group">
                <label class="form-label">채널명</label>
                <input type="text" id="bulkName" class="form-input" list="nameList" placeholder="변경하지 않으려면 비워두세요">
                <small style="color:var(--text-muted);font-size:12px;">현재 값: <span id="currentName"
                        style="font-weight:600;"></span></small>
            </div>
            <div class="form-group">
                <label class="form-label">그룹</label>
                <input type="text" id="bulkGroup" class="form-input" list="groupList" placeholder="변경하지 않으려면 비워두세요">
                <small style="color:var(--text-muted);font-size:12px;">현재 값: <span id="currentGroup"
                        style="font-weight:600;"></span></small>
            </div>
            <div class="form-group">
                <label class="form-label">유형</label>
                <select id="bulkType" class="form-select">
                    <option value="">변경하지 않음</option>
                </select>
                <small style="color:var(--text-muted);font-size:12px;">현재 값: <span id="currentType"
                        style="font-weight:600;"></span></small>
            </div>
            <div class="form-group">
                <label class="form-label">계약유형</label>
                <select id="bulkContractType" class="form-select">
                    <option value="">변경하지 않음</option>
                </select>
                <small style="color:var(--text-muted);font-size:12px;">현재 값: <span id="currentContractType"
                        style="font-weight:600;"></span></small>
            </div>
            <div class="form-group">
                <label class="form-label">담당자</label>
                <input type="text" id="bulkOwner" class="form-input" list="ownerList" placeholder="변경하지 않으려면 비워두세요">
                <small style="color:var(--text-muted);font-size:12px;">현재 값: <span id="currentOwner"
                        style="font-weight:600;"></span></small>
            </div>
            <div class="form-group">
                <label class="form-label">실시간 데이터소스</label>
                <input type="text" id="bulkLiveSource" class="form-input" list="liveSourceList"
                    placeholder="변경하지 않으려면 비워두세요">
                <small style="color:var(--text-muted);font-size:12px;">현재 값: <span id="currentLiveSource"
                        style="font-weight:600;"></span></small>
            </div>
            <div class="form-group">
                <label class="form-label">사방넷몰ID</label>
                <input type="text" id="bulkSabangnetMallID" class="form-input" list="sabangnetMallIDList"
                    placeholder="변경하지 않으려면 비워두세요">
                <small style="color:var(--text-muted);font-size:12px;">현재 값: <span id="currentSabangnetMallID"
                        style="font-weight:600;"></span></small>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeBulkEditChannelModal()">
                <i class="fa-solid fa-times"></i> 취소
            </button>
            <button class="btn btn-primary" onclick="saveBulkEditChannel()">
                <i class="fa-solid fa-save"></i> 저장
            </button>
        </div>
    </div>
</div>

<!-- 디테일 선택 수정 모달 -->
<div class="modal" id="bulkEditModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">상세정보 선택 수정</h3>
            <button class="modal-close" onclick="closeBulkEditModal()">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        <div class="modal-body" style="max-height:70vh;overflow-y:auto;">
            <div style="background:var(--bg-hover);padding:12px;border-radius:6px;margin-bottom:16px;">
                <p style="margin:0;color:var(--text-muted);font-size:13px;">
                    <i class="fa-solid fa-info-circle"></i> 선택한 <span id="bulkEditCount"
                        style="color:var(--accent);font-weight:600;">0</span>개 상세정보를 수정합니다.
                </p>
            </div>
            <h4 style="margin-bottom:16px;color:var(--accent);">ChannelDetail 테이블 정보</h4>
            <div class="form-group">
                <label class="form-label">사업자번호</label>
                <input type="text" id="bulkBizNumber" class="form-input" placeholder="변경하지 않으려면 비워두세요">
                <small style="color:var(--text-muted);font-size:12px;">현재 값: <span id="currentBizNumber"
                        style="font-weight:600;"></span></small>
            </div>
            <div class="form-group">
                <label class="form-label">거래처명</label>
                <input type="text" id="bulkDetailName" class="form-input" list="detailNameList"
                    placeholder="변경하지 않으려면 비워두세요">
                <small style="color:var(--text-muted);font-size:12px;">현재 값: <span id="currentDetailName"
                        style="font-weight:600;"></span></small>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeBulkEditModal()">
                <i class="fa-solid fa-times"></i> 취소
            </button>
            <button class="btn btn-primary" onclick="saveBulkEdit()">
                <i class="fa-solid fa-save"></i> 저장
            </button>
        </div>
    </div>
</div>

<!-- 상세 추가 모달 -->
<div class="modal" id="addDetailModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">상세정보 추가</h3>
            <button class="modal-close" onclick="closeAddDetailModal()">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        <div class="modal-body">
            <h4 style="margin-bottom:16px;color:var(--accent);">ChannelDetail 테이블 정보</h4>
            <div class="form-group">
                <label class="form-label required">사업자번호</label>
                <input type="text" id="detailBizNumber" class="form-input" required>
            </div>
            <div class="form-group">
                <label class="form-label required">거래처명</label>
                <input type="text" id="detailDetailName" class="form-input" list="detailNameList" required>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeAddDetailModal()">
                <i class="fa-solid fa-times"></i> 취소
            </button>
            <button class="btn btn-success" onclick="saveDetail()">
                <i class="fa-solid fa-save"></i> 저장
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="/static/js/pages/channels.js"></script>
{% endblock %}